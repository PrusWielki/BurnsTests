<script lang="ts">
	import { TEST_NAMES } from '$lib/cms/tests/tests';
	import { _getTestData } from './+page';
	import { enhance } from '$app/forms';

	let testData: ReturnType<typeof _getTestData>;
	let testName: string | null = 'Choose a test';
	const updateTestData = (testName: string | null) => {
		if (testName) testData = _getTestData(testName.toLowerCase());
	};
	$: updateTestData(testName);

	// 1. Make the endpoint actually throw an error
	// 2. Forms resets incorrectly
	// 2. Add some help modal
	// 3. Auto scroll on select click
</script>

<section id="test-wrapper" class="w-full h-full bg-base-100">
	<div class="container px-6 py-20 mx-auto flex flex-col items-center w-full">
		<form
			class="flex flex-col items-center w-full max-w-4xl"
			method="post"
			action="?/saveTest"
			use:enhance
		>
			<select
				name="testName"
				bind:value={testName}
				class="select select-bordered !px-4 select-accent sm:text-2xl w-full max-w-xs"
			>
				<option disabled selected class="text-center p-0 m-0">Choose a test</option>
				{#each TEST_NAMES as test}
					<option class="text-center p-0 m-0" value={test}>{test}</option>
				{/each}
			</select>
			{#if testData}
				{#each testData.questions as question, index}
					<div class="flex flex-col sm:flex-row items-center justify-center sm:gap-2 w-full">
						<p
							class="sm:w-1/2 py-4 w-full sm:justify-start text-center sm:text-start text-xl sm:text-2xl"
						>
							{index + 1}.{' '}{question}
						</p>
						<div class="sm:w-1/2 w-full sm:justify-end">
							<input
								required
								type="range"
								name={`question-${index}`}
								min={testData.minRange}
								max={testData.maxRange}
								value={0}
								class="range range-accent range-sm sm:range-md"
								step={1}
							/>
							<div class="w-full flex justify-between text-xs px-2">
								{#each Array(testData.maxRange - testData.minRange + 1) as _, number}
									<span>{number}</span>
								{/each}
							</div>
						</div>
					</div>
					<div class="divider"></div>
				{/each}
				<textarea
					class="textarea textarea-bordered w-full"
					name="description"
					placeholder="additional information"
				></textarea>
				<div class="divider"></div>
				<button class="btn btn-primary w-full" type="submit">Save answers</button>
			{/if}
		</form>
	</div>
</section>
